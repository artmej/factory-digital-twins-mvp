---
# SCADA HTML Content
apiVersion: v1
kind: ConfigMap
metadata:
  name: scada-html
  namespace: smart-factory
data:
  index.html: |
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Smart Factory SCADA - Azure Local</title>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { 
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                background: #1a1a1a; color: #fff;
                overflow: hidden;
            }
            .header {
                background: linear-gradient(135deg, #0078d4, #106ebe);
                padding: 1rem;
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 3px solid #00d4ff;
            }
            .logo { font-size: 1.5rem; font-weight: bold; }
            .status { 
                display: flex; 
                gap: 1rem; 
                align-items: center; 
            }
            .status-item {
                background: rgba(255,255,255,0.1);
                padding: 0.5rem 1rem;
                border-radius: 20px;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            .status-dot {
                width: 10px; height: 10px;
                border-radius: 50%;
                background: #00ff00;
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }
            .dashboard {
                display: grid;
                grid-template-columns: 1fr 1fr 1fr;
                grid-template-rows: 1fr 1fr;
                gap: 1rem;
                padding: 1rem;
                height: calc(100vh - 100px);
            }
            .panel {
                background: #2d2d2d;
                border: 2px solid #444;
                border-radius: 10px;
                padding: 1rem;
                overflow: hidden;
                position: relative;
            }
            .panel h3 {
                color: #00d4ff;
                margin-bottom: 1rem;
                font-size: 1.2rem;
                border-bottom: 2px solid #444;
                padding-bottom: 0.5rem;
            }
            .metric {
                display: flex;
                justify-content: space-between;
                margin-bottom: 0.5rem;
                padding: 0.5rem;
                background: rgba(255,255,255,0.05);
                border-radius: 5px;
            }
            .metric-value {
                font-weight: bold;
                color: #00ff00;
            }
            .factory-overview {
                grid-column: 1 / 3;
            }
            .robot-status {
                grid-row: 1 / 3;
            }
            .production-lines {
                grid-column: 1 / 2;
            }
            .alerts {
                background: #4a1a1a;
                border-color: #ff4444;
            }
            .robot-item {
                background: rgba(255,255,255,0.05);
                margin-bottom: 0.5rem;
                padding: 0.5rem;
                border-radius: 5px;
                border-left: 4px solid #00ff00;
            }
            .robot-item.warning { border-left-color: #ffaa00; }
            .robot-item.error { border-left-color: #ff4444; }
            .progress-bar {
                background: #444;
                height: 10px;
                border-radius: 5px;
                overflow: hidden;
                margin-top: 0.5rem;
            }
            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, #00ff00, #00d4ff);
                transition: width 0.5s;
            }
            .azure-local-badge {
                position: absolute;
                top: 10px;
                right: 10px;
                background: #0078d4;
                color: white;
                padding: 0.3rem 0.8rem;
                border-radius: 15px;
                font-size: 0.8rem;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div class="header">
            <div class="logo">üè≠ Smart Factory SCADA</div>
            <div class="status">
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span>Azure Local Connected</span>
                </div>
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span>AKS Cluster: Online</span>
                </div>
                <div class="status-item" id="timestamp">
                    <span>Loading...</span>
                </div>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="panel factory-overview">
                <div class="azure-local-badge">Azure Local Edge</div>
                <h3>üè≠ Factory Overview</h3>
                <div id="factory-metrics">
                    <div class="metric">
                        <span>Total Production Units</span>
                        <span class="metric-value" id="total-units">0</span>
                    </div>
                    <div class="metric">
                        <span>Overall Equipment Effectiveness</span>
                        <span class="metric-value" id="oee">0%</span>
                    </div>
                    <div class="metric">
                        <span>Quality Rate</span>
                        <span class="metric-value" id="quality">0%</span>
                    </div>
                    <div class="metric">
                        <span>Production Efficiency</span>
                        <span class="metric-value" id="efficiency">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="efficiency-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div class="panel robot-status">
                <h3>ü§ñ Robot Fleet Status</h3>
                <div id="robot-list">
                    <div class="robot-item">
                        <strong>KUKA KR 10 R1100</strong> - Assembly Line Alpha<br>
                        Status: <span style="color: #00ff00;">Operational</span><br>
                        Load: <span id="robot1-load">0%</span> | Cycles: <span id="robot1-cycles">0</span>
                    </div>
                    <div class="robot-item">
                        <strong>Universal Robots UR5e</strong> - Packaging Line Beta<br>
                        Status: <span style="color: #00ff00;">Operational</span><br>
                        Load: <span id="robot2-load">0%</span> | Cycles: <span id="robot2-cycles">0</span>
                    </div>
                    <div class="robot-item">
                        <strong>MiR250 AGV</strong> - Warehouse Transport<br>
                        Status: <span id="agv-status" style="color: #00ff00;">Idle</span><br>
                        Battery: <span id="agv-battery">95%</span> | Position: (<span id="agv-x">100</span>, <span id="agv-y">50</span>)
                    </div>
                </div>
            </div>
            
            <div class="panel production-lines">
                <h3>‚öôÔ∏è Production Lines</h3>
                <div id="lines-data">
                    <div class="metric">
                        <span>Assembly Line Alpha</span>
                        <span class="metric-value" id="line1-speed">0 units/min</span>
                    </div>
                    <div class="metric">
                        <span>Packaging Line Beta</span>
                        <span class="metric-value" id="line2-speed">0 units/min</span>
                    </div>
                    <div class="metric">
                        <span>Line 1 Output Today</span>
                        <span class="metric-value" id="line1-output">0</span>
                    </div>
                    <div class="metric">
                        <span>Line 2 Output Today</span>
                        <span class="metric-value" id="line2-output">0</span>
                    </div>
                </div>
            </div>
            
            <div class="panel alerts">
                <h3>‚ö†Ô∏è System Alerts</h3>
                <div id="alerts-list">
                    <div style="color: #00ff00;">‚úÖ All systems operational</div>
                    <div style="color: #00d4ff;">‚ÑπÔ∏è Azure Local sync active</div>
                    <div style="color: #00d4ff;">‚ÑπÔ∏è Edge processing enabled</div>
                </div>
            </div>
        </div>
        
        <script>
            // Update timestamp
            setInterval(() => {
                document.getElementById('timestamp').innerHTML = 
                    `<span>${new Date().toLocaleString()}</span>`;
            }, 1000);
            
            // Simulate factory data updates
            function updateFactoryData() {
                // Factory metrics
                document.getElementById('total-units').textContent = 
                    Math.floor(Math.random() * 10000) + 50000;
                const efficiency = Math.floor(Math.random() * 20) + 80;
                document.getElementById('efficiency').textContent = efficiency + '%';
                document.getElementById('efficiency-bar').style.width = efficiency + '%';
                document.getElementById('oee').textContent = (efficiency - 5) + '%';
                document.getElementById('quality').textContent = (95 + Math.random() * 5).toFixed(1) + '%';
                
                // Production lines
                document.getElementById('line1-speed').textContent = 
                    (Math.floor(Math.random() * 50) + 150) + ' units/min';
                document.getElementById('line2-speed').textContent = 
                    (Math.floor(Math.random() * 40) + 120) + ' units/min';
                document.getElementById('line1-output').textContent = 
                    Math.floor(Math.random() * 1000) + 5000;
                document.getElementById('line2-output').textContent = 
                    Math.floor(Math.random() * 800) + 4000;
                
                // Robots
                document.getElementById('robot1-load').textContent = 
                    Math.floor(Math.random() * 40) + 60 + '%';
                document.getElementById('robot1-cycles').textContent = 
                    Math.floor(Math.random() * 1000) + 15000;
                document.getElementById('robot2-load').textContent = 
                    Math.floor(Math.random() * 30) + 70 + '%';
                document.getElementById('robot2-cycles').textContent = 
                    Math.floor(Math.random() * 800) + 12000;
                
                // AGV
                const agvX = Math.floor(Math.random() * 200) + 50;
                const agvY = Math.floor(Math.random() * 100) + 25;
                document.getElementById('agv-x').textContent = agvX;
                document.getElementById('agv-y').textContent = agvY;
                document.getElementById('agv-battery').textContent = 
                    (90 + Math.random() * 10).toFixed(0) + '%';
                
                // Occasionally change AGV status
                if (Math.random() > 0.8) {
                    const statuses = ['Idle', 'Moving', 'Loading', 'Docking'];
                    document.getElementById('agv-status').textContent = 
                        statuses[Math.floor(Math.random() * statuses.length)];
                }
            }
            
            // Update every 2 seconds
            setInterval(updateFactoryData, 2000);
            updateFactoryData(); // Initial update
            
            console.log('üè≠ SCADA Dashboard loaded - Azure Local Edge Deployment');
        </script>
    </body>
    </html>

---
# SCADA Nginx Configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: scada-nginx-config
  namespace: smart-factory
data:
  default.conf: |
    server {
        listen 8084;
        server_name localhost;
        
        # Root directory
        root /usr/share/nginx/html;
        index index.html;
        
        # Static files
        location / {
            try_files $uri $uri/ /index.html;
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
            add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range';
        }
        
        # API proxy to backend
        location /api/ {
            proxy_pass http://localhost:3000/api/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            add_header 'Access-Control-Allow-Origin' '*';
        }
        
        # Health check
        location /health {
            return 200 'SCADA Dashboard Healthy\n';
            add_header Content-Type text/plain;
        }
        
        # Gzip compression
        gzip on;
        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;
    }

---
# Secrets (base64 encoded values)
apiVersion: v1
kind: Secret
metadata:
  name: factory-secrets
  namespace: smart-factory
type: Opaque
data:
  # admin / smartfactory2024 (base64 encoded)
  db-username: YWRtaW4=
  db-password: c21hcnRmYWN0b3J5MjAyNA==
  # Redis password
  redis-password: cmVkaXNwYXNzMjAyNA==
  # API keys
  api-key: c21hcnQtZmFjdG9yeS1hcGkta2V5LTIwMjQ=