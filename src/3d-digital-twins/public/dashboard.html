<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè≠ Smart Factory 3D Digital Twins</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            overflow: hidden;
            color: white;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #threejs-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* HUD Overlay */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff88;
            min-width: 300px;
        }
        
        .hud-title {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 15px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .metric-label {
            color: #ccc;
        }
        
        .metric-value {
            color: #fff;
            font-weight: bold;
        }
        
        .metric-value.good { color: #00ff88; }
        .metric-value.warning { color: #ffaa00; }
        .metric-value.critical { color: #ff4444; }
        
        /* User Info */
        #user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #00ff88;
            text-align: center;
        }
        
        .logout-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 12px;
        }
        
        .logout-btn:hover {
            background: #cc3333;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="threejs-container"></div>
        
        <div id="hud">
            <div class="hud-title">üè≠ Factory Status</div>
            <div class="metric">
                <span class="metric-label">Production:</span>
                <span class="metric-value good" id="production">98.5%</span>
            </div>
            <div class="metric">
                <span class="metric-label">Efficiency:</span>
                <span class="metric-value good" id="efficiency">94.2%</span>
            </div>
            <div class="metric">
                <span class="metric-label">Temperature:</span>
                <span class="metric-value" id="temperature">72¬∞C</span>
            </div>
            <div class="metric">
                <span class="metric-label">Alerts:</span>
                <span class="metric-value" id="alerts">2 Active</span>
            </div>
            <div class="metric">
                <span class="metric-label">Machines Online:</span>
                <span class="metric-value good" id="machines">12/12</span>
            </div>
        </div>
        
        <div id="user-info">
            <div>üë§ <span id="user-name">Loading...</span></div>
            <div style="font-size: 12px; opacity: 0.8; margin-top: 5px;" id="user-email">Loading...</div>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="factory-3d.js"></script>
    
    <script>
        // Check authentication
        function checkAuth() {
            const authData = localStorage.getItem('smartfactory_auth');
            if (!authData) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const auth = JSON.parse(authData);
                if (!auth.authenticated) {
                    window.location.href = 'login.html';
                    return;
                }
                
                // Update user info
                document.getElementById('user-name').textContent = auth.name || 'User';
                document.getElementById('user-email').textContent = auth.user || '';
                
            } catch (e) {
                localStorage.removeItem('smartfactory_auth');
                window.location.href = 'login.html';
            }
        }
        
        function logout() {
            localStorage.removeItem('smartfactory_auth');
            window.location.href = 'login.html';
        }
        
        // Initialize
        checkAuth();
        
        // Initialize 3D Scene (simplified for now)
        function init3D() {
            const container = document.getElementById('threejs-container');
            
            // Scene
            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1e3c72);
            
            // Camera
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 20);
            
            // Renderer
            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);
            
            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 50);
            scene.add(directionalLight);
            
            // Simple factory floor
            const floorGeometry = new THREE.PlaneGeometry(40, 40);
            const floorMaterial = new THREE.MeshLambertMaterial({ color: 0x444444 });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);
            
            // Add some factory machines (cubes for now)
            for (let i = 0; i < 6; i++) {
                const geometry = new THREE.BoxGeometry(2, 3, 2);
                const material = new THREE.MeshLambertMaterial({ color: Math.random() * 0x00ff88 + 0x004400 });
                const machine = new THREE.Mesh(geometry, material);
                machine.position.x = (i % 3 - 1) * 8;
                machine.position.y = 1.5;
                machine.position.z = Math.floor(i / 3) * 8 - 4;
                scene.add(machine);
            }
            
            // Controls
            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.1;
            
            // Animation loop
            function animate() {
                requestAnimationFrame(animate);
                controls.update();
                renderer.render(scene, camera);
            }
            animate();
            
            // Handle resize
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
        
        // Start 3D scene
        init3D();
        
        // Update metrics periodically
        setInterval(() => {
            document.getElementById('production').textContent = (95 + Math.random() * 5).toFixed(1) + '%';
            document.getElementById('efficiency').textContent = (90 + Math.random() * 8).toFixed(1) + '%';
            document.getElementById('temperature').textContent = (70 + Math.random() * 5).toFixed(0) + '¬∞C';
        }, 3000);
    </script>
</body>
</html>