// üöÄ Smart Factory AI Agent - Main Interface\n// Complete AI Agent Integration with PWA Dashboard\n\nimport SmartFactoryAgent from './agent-core.js';\n\n// ü§ñ Initialize and integrate AI Agent with dashboard\nclass AgentDashboardIntegration {\n    constructor() {\n        this.agent = null;\n        this.isInitialized = false;\n        this.chatInterface = null;\n        this.agentStatus = {\n            active: false,\n            confidence: 0,\n            decisions_today: 0,\n            actions_executed: 0\n        };\n    }\n    \n    // üöÄ Initialize agent integration\n    async initialize() {\n        console.log('ü§ñ Initializing Smart Factory AI Agent integration...');\n        \n        try {\n            // Create agent instance\n            this.agent = new SmartFactoryAgent();\n            \n            // Initialize agent\n            const success = await this.agent.initialize();\n            \n            if (success) {\n                this.isInitialized = true;\n                \n                // Setup dashboard integration\n                this.setupDashboardIntegration();\n                \n                // Setup chat interface\n                this.setupChatInterface();\n                \n                // Setup status updates\n                this.setupStatusUpdates();\n                \n                console.log('‚úÖ AI Agent integration complete');\n                \n                // Show agent activation notification\n                this.showAgentActivationNotification();\n                \n                return true;\n            }\n            \n        } catch (error) {\n            console.error('‚ùå AI Agent integration failed:', error);\n            this.showAgentErrorNotification(error.message);\n            return false;\n        }\n    }\n    \n    // üìä Setup dashboard integration\n    setupDashboardIntegration() {\n        console.log('üìä Setting up dashboard integration...');\n        \n        // Add AI insights to existing dashboard updates\n        window.updateAIInsights = (insights) => {\n            this.updateDashboardWithAIInsights(insights);\n        };\n        \n        // Add automation status updates\n        window.updateAutomationStatus = (status) => {\n            this.updateAutomationDisplay(status);\n        };\n        \n        // Add agent status panel to dashboard\n        this.addAgentStatusPanel();\n        \n        // Add AI chat widget\n        this.addChatWidget();\n    }\n    \n    // ü§ñ Add agent status panel\n    addAgentStatusPanel() {\n        const statusPanel = document.createElement('div');\n        statusPanel.id = 'ai-agent-status';\n        statusPanel.innerHTML = `\n            <div style=\"\n                position: fixed;\n                top: 80px;\n                right: 20px;\n                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                color: white;\n                padding: 15px;\n                border-radius: 10px;\n                box-shadow: 0 4px 15px rgba(0,0,0,0.3);\n                backdrop-filter: blur(10px);\n                z-index: 1000;\n                min-width: 280px;\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n            \">\n                <div style=\"display: flex; align-items: center; margin-bottom: 10px;\">\n                    <div style=\"width: 12px; height: 12px; border-radius: 50%; background: #4CAF50; margin-right: 8px; animation: pulse 2s infinite;\"></div>\n                    <h3 style=\"margin: 0; font-size: 14px; font-weight: 600;\">ü§ñ FactoryBot AI Agent</h3>\n                </div>\n                \n                <div style=\"font-size: 12px; opacity: 0.9; line-height: 1.4;\">\n                    <div style=\"margin: 5px 0;\">üìä Confidence: <span id=\"agent-confidence\">95%</span></div>\n                    <div style=\"margin: 5px 0;\">üéØ Decisions Today: <span id=\"agent-decisions\">0</span></div>\n                    <div style=\"margin: 5px 0;\">‚ö° Actions Executed: <span id=\"agent-actions\">0</span></div>\n                    <div style=\"margin: 5px 0;\">üß† Status: <span id=\"agent-status\">Active</span></div>\n                </div>\n                \n                <div style=\"margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.2);\">\n                    <div style=\"font-size: 11px; opacity: 0.8;\">\n                        üîÑ Monitoring factory operations autonomously\n                    </div>\n                </div>\n            </div>\n            \n            <style>\n                @keyframes pulse {\n                    0% { opacity: 1; }\n                    50% { opacity: 0.5; }\n                    100% { opacity: 1; }\n                }\n            </style>\n        `;\n        \n        document.body.appendChild(statusPanel);\n    }\n    \n    // üí¨ Add chat widget\n    addChatWidget() {\n        const chatWidget = document.createElement('div');\n        chatWidget.id = 'ai-chat-widget';\n        chatWidget.innerHTML = `\n            <div id=\"chat-button\" style=\"\n                position: fixed;\n                bottom: 30px;\n                right: 30px;\n                width: 60px;\n                height: 60px;\n                border-radius: 50%;\n                background: linear-gradient(45deg, #4CAF50, #45a049);\n                color: white;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                cursor: pointer;\n                box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);\n                z-index: 1001;\n                transition: all 0.3s ease;\n                font-size: 24px;\n            \" onclick=\"toggleChat()\">\n                ü§ñ\n            </div>\n            \n            <div id=\"chat-container\" style=\"\n                position: fixed;\n                bottom: 100px;\n                right: 30px;\n                width: 350px;\n                height: 500px;\n                background: white;\n                border-radius: 15px;\n                box-shadow: 0 8px 30px rgba(0,0,0,0.3);\n                z-index: 1002;\n                display: none;\n                flex-direction: column;\n                overflow: hidden;\n            \">\n                <div style=\"\n                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n                    color: white;\n                    padding: 15px;\n                    font-weight: 600;\n                    text-align: center;\n                \">\n                    ü§ñ FactoryBot Assistant\n                </div>\n                \n                <div id=\"chat-messages\" style=\"\n                    flex: 1;\n                    overflow-y: auto;\n                    padding: 15px;\n                    background: #f8f9fa;\n                \">\n                    <div style=\"\n                        background: #e3f2fd;\n                        padding: 10px;\n                        border-radius: 8px;\n                        margin-bottom: 10px;\n                        font-size: 14px;\n                    \">\n                        üëã Hello! I'm FactoryBot, your AI assistant. I can help you with factory operations, maintenance, and insights. What would you like to know?\n                    </div>\n                </div>\n                \n                <div style=\"\n                    padding: 15px;\n                    border-top: 1px solid #eee;\n                    display: flex;\n                    gap: 10px;\n                \">\n                    <input id=\"chat-input\" type=\"text\" placeholder=\"Ask about factory status, maintenance, etc...\" style=\"\n                        flex: 1;\n                        padding: 10px;\n                        border: 1px solid #ddd;\n                        border-radius: 8px;\n                        font-size: 14px;\n                    \" onkeypress=\"handleChatKeypress(event)\">\n                    <button onclick=\"sendChatMessage()\" style=\"\n                        background: linear-gradient(45deg, #667eea, #764ba2);\n                        color: white;\n                        border: none;\n                        padding: 10px 15px;\n                        border-radius: 8px;\n                        cursor: pointer;\n                        font-size: 14px;\n                    \">Send</button>\n                </div>\n            </div>\n        `;\n        \n        document.body.appendChild(chatWidget);\n        \n        // Add chat functions to global scope\n        window.toggleChat = () => {\n            const container = document.getElementById('chat-container');\n            container.style.display = container.style.display === 'none' ? 'flex' : 'none';\n        };\n        \n        window.handleChatKeypress = (event) => {\n            if (event.key === 'Enter') {\n                this.sendChatMessage();\n            }\n        };\n        \n        window.sendChatMessage = () => {\n            this.sendChatMessage();\n        };\n    }\n    \n    // üí¨ Setup chat interface\n    setupChatInterface() {\n        this.chatInterface = {\n            addMessage: (message, isUser = false) => {\n                const messagesContainer = document.getElementById('chat-messages');\n                const messageDiv = document.createElement('div');\n                messageDiv.style.cssText = `\n                    background: ${isUser ? '#667eea' : '#e3f2fd'};\n                    color: ${isUser ? 'white' : '#333'};\n                    padding: 10px;\n                    border-radius: 8px;\n                    margin-bottom: 10px;\n                    font-size: 14px;\n                    ${isUser ? 'margin-left: 40px;' : 'margin-right: 40px;'}\n                `;\n                messageDiv.innerHTML = message;\n                messagesContainer.appendChild(messageDiv);\n                messagesContainer.scrollTop = messagesContainer.scrollHeight;\n            },\n            \n            addTypingIndicator: () => {\n                const messagesContainer = document.getElementById('chat-messages');\n                const typingDiv = document.createElement('div');\n                typingDiv.id = 'typing-indicator';\n                typingDiv.style.cssText = `\n                    background: #f0f0f0;\n                    padding: 10px;\n                    border-radius: 8px;\n                    margin-bottom: 10px;\n                    margin-right: 40px;\n                    font-size: 14px;\n                    color: #666;\n                    font-style: italic;\n                `;\n                typingDiv.innerHTML = 'ü§ñ FactoryBot is thinking...';\n                messagesContainer.appendChild(typingDiv);\n                messagesContainer.scrollTop = messagesContainer.scrollHeight;\n            },\n            \n            removeTypingIndicator: () => {\n                const typingIndicator = document.getElementById('typing-indicator');\n                if (typingIndicator) {\n                    typingIndicator.remove();\n                }\n            }\n        };\n    }\n    \n    // üí¨ Send chat message\n    async sendChatMessage() {\n        const input = document.getElementById('chat-input');\n        const message = input.value.trim();\n        \n        if (!message || !this.isInitialized) return;\n        \n        // Add user message\n        this.chatInterface.addMessage(message, true);\n        input.value = '';\n        \n        // Show typing indicator\n        this.chatInterface.addTypingIndicator();\n        \n        try {\n            // Process message with AI agent\n            const response = await this.agent.processMessage(message);\n            \n            // Remove typing indicator\n            this.chatInterface.removeTypingIndicator();\n            \n            // Add agent response\n            this.chatInterface.addMessage(response.message, false);\n            \n            // Execute any actions\n            if (response.actions && response.actions.length > 0) {\n                this.executeAgentActions(response.actions);\n            }\n            \n        } catch (error) {\n            console.error('Chat error:', error);\n            this.chatInterface.removeTypingIndicator();\n            this.chatInterface.addMessage('Sorry, I encountered an error. Please try again.', false);\n        }\n    }\n    \n    // ‚ö° Execute agent actions\n    executeAgentActions(actions) {\n        for (const action of actions) {\n            switch (action) {\n                case 'show_dashboard':\n                    // Scroll to main dashboard\n                    document.getElementById('dashboard')?.scrollIntoView({ behavior: 'smooth' });\n                    break;\n                    \n                case 'show_maintenance_calendar':\n                    // Open maintenance calendar\n                    window.open('maintenance-calendar.html', '_blank');\n                    break;\n                    \n                case 'show_energy_dashboard':\n                    // Highlight energy section\n                    this.highlightDashboardSection('energy');\n                    break;\n                    \n                case 'show_help_options':\n                    this.showHelpOptions();\n                    break;\n            }\n        }\n    }\n    \n    // üí° Show help options\n    showHelpOptions() {\n        const helpMessage = `\n            <div style=\"margin-top: 10px;\">\n                <strong>I can help you with:</strong><br>\n                üîß \"What's the factory status?\"<br>\n                üìä \"Show me production metrics\"<br>\n                ‚ö° \"How's our energy usage?\"<br>\n                üö® \"Any maintenance alerts?\"<br>\n                ü§ñ \"Run optimization analysis\"<br>\n                üìÖ \"When is next maintenance?\"\n            </div>\n        `;\n        \n        this.chatInterface.addMessage(helpMessage, false);\n    }\n    \n    // üéØ Highlight dashboard section\n    highlightDashboardSection(section) {\n        // Add visual highlight to relevant dashboard section\n        const sectionElement = document.querySelector(`[data-section=\"${section}\"]`);\n        if (sectionElement) {\n            sectionElement.style.outline = '3px solid #4CAF50';\n            sectionElement.style.boxShadow = '0 0 20px rgba(76, 175, 80, 0.5)';\n            \n            setTimeout(() => {\n                sectionElement.style.outline = '';\n                sectionElement.style.boxShadow = '';\n            }, 3000);\n        }\n    }\n    \n    // üìä Setup status updates\n    setupStatusUpdates() {\n        // Update status every 30 seconds\n        setInterval(() => {\n            this.updateAgentStatus();\n        }, 30000);\n        \n        // Initial update\n        this.updateAgentStatus();\n    }\n    \n    // üìà Update agent status\n    async updateAgentStatus() {\n        if (!this.agent) return;\n        \n        try {\n            const status = this.agent.getStatus();\n            \n            // Update status display\n            const confidenceElement = document.getElementById('agent-confidence');\n            const decisionsElement = document.getElementById('agent-decisions');\n            const actionsElement = document.getElementById('agent-actions');\n            const statusElement = document.getElementById('agent-status');\n            \n            if (confidenceElement) {\n                confidenceElement.textContent = `${Math.round(status.confidence * 100)}%`;\n            }\n            \n            if (decisionsElement) {\n                decisionsElement.textContent = status.memory_size || 0;\n            }\n            \n            if (actionsElement) {\n                actionsElement.textContent = this.agentStatus.actions_executed;\n            }\n            \n            if (statusElement) {\n                statusElement.textContent = status.active ? 'Active' : 'Inactive';\n            }\n            \n        } catch (error) {\n            console.error('Status update error:', error);\n        }\n    }\n    \n    // üìä Update dashboard with AI insights\n    updateDashboardWithAIInsights(insights) {\n        console.log('üìä Updating dashboard with AI insights:', insights);\n        \n        // Add AI insights panel to dashboard if it doesn't exist\n        let insightsPanel = document.getElementById('ai-insights-panel');\n        if (!insightsPanel) {\n            insightsPanel = document.createElement('div');\n            insightsPanel.id = 'ai-insights-panel';\n            insightsPanel.innerHTML = `\n                <div style=\"\n                    background: rgba(255,255,255,0.1);\n                    backdrop-filter: blur(10px);\n                    border-radius: 15px;\n                    padding: 20px;\n                    margin: 20px;\n                    border: 1px solid rgba(255,255,255,0.2);\n                \">\n                    <h3 style=\"margin: 0 0 15px 0; color: white; font-size: 18px;\">üß† AI Insights</h3>\n                    <div id=\"ai-insights-content\" style=\"color: white; font-size: 14px;\"></div>\n                </div>\n            `;\n            \n            // Insert into dashboard\n            const dashboard = document.getElementById('dashboard');\n            if (dashboard) {\n                dashboard.appendChild(insightsPanel);\n            }\n        }\n        \n        // Update insights content\n        const content = document.getElementById('ai-insights-content');\n        if (content && insights) {\n            content.innerHTML = `\n                <div style=\"margin-bottom: 10px;\">\n                    <strong>üìä Analysis Type:</strong> ${insights.type || 'Real-time Analysis'}\n                </div>\n                <div style=\"margin-bottom: 10px;\">\n                    <strong>üéØ Confidence:</strong> ${insights.confidence ? Math.round(insights.confidence * 100) + '%' : 'N/A'}\n                </div>\n                <div style=\"margin-bottom: 10px;\">\n                    <strong>‚è∞ Last Update:</strong> ${new Date(insights.timestamp).toLocaleTimeString()}\n                </div>\n                ${insights.optimizations ? `\n                    <div style=\"margin-top: 15px;\">\n                        <strong>üí° Recommendations:</strong>\n                        <ul style=\"margin: 5px 0; padding-left: 20px;\">\n                            ${Object.values(insights.optimizations).map(opt => \n                                opt.recommendations?.map(rec => `<li>${rec}</li>`).join('') || ''\n                            ).join('')}\n                        </ul>\n                    </div>\n                ` : ''}\n            `;\n        }\n    }\n    \n    // ‚öôÔ∏è Update automation display\n    updateAutomationDisplay(status) {\n        console.log('‚öôÔ∏è Updating automation display:', status);\n        \n        this.agentStatus.actions_executed++;\n        \n        // Show automation notification\n        this.showNotification(\n            `ü§ñ Automation: ${status.event}`,\n            status.data?.message || 'Action completed successfully',\n            'success'\n        );\n    }\n    \n    // üîî Show notification\n    showNotification(title, message, type = 'info') {\n        const notification = document.createElement('div');\n        notification.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3'};\n            color: white;\n            padding: 15px 20px;\n            border-radius: 10px;\n            box-shadow: 0 4px 15px rgba(0,0,0,0.3);\n            z-index: 10000;\n            max-width: 300px;\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        `;\n        \n        notification.innerHTML = `\n            <div style=\"font-weight: 600; margin-bottom: 5px;\">${title}</div>\n            <div style=\"font-size: 14px; opacity: 0.9;\">${message}</div>\n        `;\n        \n        document.body.appendChild(notification);\n        \n        // Auto remove after 5 seconds\n        setTimeout(() => {\n            if (notification.parentNode) {\n                notification.parentNode.removeChild(notification);\n            }\n        }, 5000);\n    }\n    \n    // ‚úÖ Show agent activation notification\n    showAgentActivationNotification() {\n        this.showNotification(\n            'ü§ñ AI Agent Activated',\n            'FactoryBot is now monitoring your factory operations autonomously',\n            'success'\n        );\n    }\n    \n    // ‚ùå Show agent error notification\n    showAgentErrorNotification(error) {\n        this.showNotification(\n            '‚ùå AI Agent Error',\n            `Failed to initialize: ${error}`,\n            'error'\n        );\n    }\n    \n    // üìä Get integration status\n    getStatus() {\n        return {\n            isInitialized: this.isInitialized,\n            agentActive: this.agent?.state?.active || false,\n            agentStatus: this.agentStatus,\n            capabilities: this.agent?.capabilities || [],\n            lastUpdate: new Date()\n        };\n    }\n}\n\n// üöÄ Auto-initialize when DOM is ready\nif (typeof window !== 'undefined') {\n    const agentIntegration = new AgentDashboardIntegration();\n    \n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => {\n            agentIntegration.initialize();\n        });\n    } else {\n        agentIntegration.initialize();\n    }\n    \n    // Make available globally\n    window.FactoryBotAgent = agentIntegration;\n}\n\nexport default AgentDashboardIntegration;