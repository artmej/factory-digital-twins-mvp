// ðŸ­ Enhanced Smart Factory 3D Digital Twins - Advanced Visualization\n// Next-Generation 3D Digital Twin with Realistic Models & Real-time Synchronization\n\nclass AdvancedSmartFactory3D {\n    constructor() {\n        this.scene = null;\n        this.camera = null;\n        this.renderer = null;\n        this.machines = {};\n        this.sensors = {};\n        this.digitalTwins = {}; // New: Digital twin objects\n        this.selectedMachine = null;\n        this.animationId = null;\n        this.clock = new THREE.Clock();\n        \n        // ðŸŽ¨ Advanced 3D Features\n        this.postProcessing = {\n            composer: null,\n            effects: {},\n            enabled: true\n        };\n        \n        // ðŸ­ Factory Environment\n        this.factoryEnvironment = {\n            floor: null,\n            walls: null,\n            ceiling: null,\n            conveyorBelts: [],\n            pipelines: [],\n            smokestacks: []\n        };\n        \n        // ðŸ¤– Digital Twin Intelligence\n        this.digitalTwinData = {\n            machines: new Map(),\n            sensors: new Map(),\n            production_lines: new Map(),\n            environmental: {\n                temperature: 22.5,\n                humidity: 45.2,\n                airflow: 1.8,\n                lighting: 850\n            }\n        };\n        \n        // ðŸ“Š Real-time Data Streams\n        this.dataStreams = {\n            azure_digital_twins: null,\n            iot_hub: null,\n            ml_predictions: {},\n            health_modeling: null\n        };\n        \n        // ðŸŽ¬ Animation System\n        this.animations = {\n            machines: new Map(),\n            conveyors: [],\n            particles: [],\n            environmental: []\n        };\n        \n        // ðŸŽ¯ Performance Optimization\n        this.performance = {\n            lod_enabled: true, // Level of Detail\n            culling_enabled: true,\n            instancing_enabled: true,\n            target_fps: 60,\n            current_fps: 0\n        };\n        \n        this.init();\n    }\n    \n    // ðŸš€ Initialize Enhanced 3D Scene\n    async init() {\n        console.log('ðŸ­ Initializing Advanced Smart Factory 3D Digital Twin...');\n        \n        try {\n            await this.setupAdvancedScene();\n            await this.setupRealisticLighting();\n            await this.setupAdvancedCamera();\n            await this.setupEnhancedRenderer();\n            await this.setupAdvancedControls();\n            await this.setupPostProcessing();\n            \n            // Load realistic factory environment\n            await this.createRealisticFactoryEnvironment();\n            \n            // Initialize digital twin connections\n            await this.initializeDigitalTwinConnections();\n            \n            // Start real-time data synchronization\n            this.startRealTimeSync();\n            \n            // Begin render loop\n            this.animate();\n            \n            console.log('âœ… Advanced Smart Factory 3D initialized successfully!');\n            \n        } catch (error) {\n            console.error('âŒ Failed to initialize 3D system:', error);\n            // Fallback to basic mode\n            this.initBasicMode();\n        }\n    }\n    \n    // ðŸ—ï¸ Setup Advanced Scene\n    async setupAdvancedScene() {\n        this.scene = new THREE.Scene();\n        \n        // Enhanced fog for atmospheric depth\n        this.scene.fog = new THREE.FogExp2(0x1a1a2e, 0.01);\n        \n        // Realistic sky environment\n        const loader = new THREE.CubeTextureLoader();\n        try {\n            // Industrial environment skybox\n            this.scene.background = this.createIndustrialSkybox();\n        } catch (error) {\n            // Fallback to gradient background\n            this.scene.background = this.createGradientBackground();\n        }\n        \n        // Enhanced physics world (if needed)\n        this.initPhysicsWorld();\n        \n        console.log('ðŸ—ï¸ Advanced scene setup complete');\n    }\n    \n    // ðŸ’¡ Setup Realistic Lighting\n    async setupRealisticLighting() {\n        // Ambient lighting for overall illumination\n        const ambientLight = new THREE.AmbientLight(0x404040, 0.3);\n        this.scene.add(ambientLight);\n        \n        // Main directional light (sunlight simulation)\n        const directionalLight = new THREE.DirectionalLight(0xffffff, 1.0);\n        directionalLight.position.set(50, 50, 25);\n        directionalLight.castShadow = true;\n        \n        // Enhanced shadow settings\n        directionalLight.shadow.mapSize.width = 4096;\n        directionalLight.shadow.mapSize.height = 4096;\n        directionalLight.shadow.camera.near = 0.5;\n        directionalLight.shadow.camera.far = 500;\n        directionalLight.shadow.camera.left = -50;\n        directionalLight.shadow.camera.right = 50;\n        directionalLight.shadow.camera.top = 50;\n        directionalLight.shadow.camera.bottom = -50;\n        directionalLight.shadow.bias = -0.0001;\n        \n        this.scene.add(directionalLight);\n        \n        // Industrial overhead lighting array\n        this.createIndustrialLighting();\n        \n        // Emergency and safety lighting\n        this.createSafetyLighting();\n        \n        console.log('ðŸ’¡ Realistic lighting setup complete');\n    }\n    \n    // ðŸ“¸ Setup Advanced Camera System\n    async setupAdvancedCamera() {\n        const aspect = window.innerWidth / (window.innerHeight - 80);\n        \n        // Primary camera with enhanced settings\n        this.camera = new THREE.PerspectiveCamera(60, aspect, 0.1, 2000);\n        this.camera.position.set(25, 15, 25);\n        this.camera.lookAt(0, 0, 0);\n        \n        // Camera helper for debugging (can be toggled)\n        if (window.location.search.includes('debug=true')) {\n            const helper = new THREE.CameraHelper(this.camera);\n            this.scene.add(helper);\n        }\n        \n        // Secondary cameras for different views\n        this.setupSecondaryCameras();\n        \n        console.log('ðŸ“¸ Advanced camera system ready');\n    }\n    \n    // ðŸ–¥ï¸ Setup Enhanced Renderer\n    async setupEnhancedRenderer() {\n        const container = document.getElementById('canvas-container');\n        \n        this.renderer = new THREE.WebGLRenderer({ \n            antialias: true,\n            powerPreference: \"high-performance\",\n            precision: \"highp\",\n            alpha: false\n        });\n        \n        // Enhanced render settings\n        this.renderer.setSize(window.innerWidth, window.innerHeight - 80);\n        this.renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n        \n        // Advanced shadow settings\n        this.renderer.shadowMap.enabled = true;\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n        this.renderer.shadowMap.autoUpdate = true;\n        \n        // Tone mapping for realistic lighting\n        this.renderer.toneMapping = THREE.ACESFilmicToneMapping;\n        this.renderer.toneMappingExposure = 1.0;\n        \n        // HDR and gamma correction\n        this.renderer.outputEncoding = THREE.sRGBEncoding;\n        this.renderer.gammaFactor = 2.2;\n        \n        this.renderer.setClearColor(0x1a1a2e, 1.0);\n        \n        container.appendChild(this.renderer.domElement);\n        \n        console.log('ðŸ–¥ï¸ Enhanced renderer initialized');\n    }\n    \n    // ðŸŽ® Setup Advanced Controls\n    async setupAdvancedControls() {\n        try {\n            if (typeof THREE.OrbitControls !== 'undefined') {\n                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);\n                \n                // Enhanced control settings\n                this.controls.enableDamping = true;\n                this.controls.dampingFactor = 0.05;\n                this.controls.maxPolarAngle = Math.PI / 2.1;\n                this.controls.minDistance = 5;\n                this.controls.maxDistance = 100;\n                this.controls.autoRotate = false;\n                this.controls.autoRotateSpeed = 0.5;\n                \n                // Smooth camera transitions\n                this.controls.enablePan = true;\n                this.controls.panSpeed = 1.0;\n                this.controls.enableZoom = true;\n                this.controls.zoomSpeed = 1.2;\n                \n                console.log('ðŸŽ® Advanced controls initialized');\n            } else {\n                console.warn('âš ï¸ OrbitControls not available, using enhanced basic controls');\n                this.setupEnhancedBasicControls();\n            }\n        } catch (error) {\n            console.error('âŒ Controls setup failed:', error);\n            this.setupEnhancedBasicControls();\n        }\n    }\n    \n    // âœ¨ Setup Post-Processing Effects\n    async setupPostProcessing() {\n        try {\n            // Check if post-processing libraries are available\n            if (typeof THREE.EffectComposer === 'undefined') {\n                console.log('ðŸ“¦ Loading post-processing libraries...');\n                await this.loadPostProcessingLibraries();\n            }\n            \n            // Initialize effect composer\n            this.postProcessing.composer = new THREE.EffectComposer(this.renderer);\n            \n            // Render pass\n            const renderPass = new THREE.RenderPass(this.scene, this.camera);\n            this.postProcessing.composer.addPass(renderPass);\n            \n            // SSAO (Screen Space Ambient Occlusion)\n            if (THREE.SSAOPass) {\n                const ssaoPass = new THREE.SSAOPass(this.scene, this.camera, window.innerWidth, window.innerHeight - 80);\n                ssaoPass.kernelRadius = 0.1;\n                ssaoPass.kernelSize = 32;\n                this.postProcessing.composer.addPass(ssaoPass);\n                this.postProcessing.effects.ssao = ssaoPass;\n            }\n            \n            // Bloom effect for glowing elements\n            if (THREE.UnrealBloomPass) {\n                const bloomPass = new THREE.UnrealBloomPass(\n                    new THREE.Vector2(window.innerWidth, window.innerHeight - 80),\n                    1.5, 0.4, 0.85\n                );\n                this.postProcessing.composer.addPass(bloomPass);\n                this.postProcessing.effects.bloom = bloomPass;\n            }\n            \n            // Anti-aliasing (FXAA)\n            if (THREE.ShaderPass && THREE.FXAAShader) {\n                const fxaaPass = new THREE.ShaderPass(THREE.FXAAShader);\n                const pixelRatio = this.renderer.getPixelRatio();\n                fxaaPass.material.uniforms['resolution'].value.x = 1 / (window.innerWidth * pixelRatio);\n                fxaaPass.material.uniforms['resolution'].value.y = 1 / ((window.innerHeight - 80) * pixelRatio);\n                this.postProcessing.composer.addPass(fxaaPass);\n                this.postProcessing.effects.fxaa = fxaaPass;\n            }\n            \n            console.log('âœ¨ Post-processing effects initialized');\n            \n        } catch (error) {\n            console.warn('âš ï¸ Post-processing setup failed, using basic rendering:', error);\n            this.postProcessing.enabled = false;\n        }\n    }\n    \n    // ðŸ­ Create Realistic Factory Environment\n    async createRealisticFactoryEnvironment() {\n        console.log('ðŸ­ Creating realistic factory environment...');\n        \n        try {\n            // Factory floor with realistic materials\n            await this.createFactoryFloor();\n            \n            // Industrial walls and structure\n            await this.createFactoryStructure();\n            \n            // Conveyor belt systems\n            await this.createConveyorSystems();\n            \n            // Industrial equipment and machinery\n            await this.createMachineryModels();\n            \n            // Piping and ventilation systems\n            await this.createInfrastructureSystems();\n            \n            // Safety equipment and signage\n            await this.createSafetyEquipment();\n            \n            // Environmental elements\n            await this.createEnvironmentalElements();\n            \n            console.log('âœ… Realistic factory environment created');\n            \n        } catch (error) {\n            console.error('âŒ Factory environment creation failed:', error);\n            // Fallback to basic environment\n            this.createBasicFactoryEnvironment();\n        }\n    }\n    \n    // ðŸ¢ Create Factory Floor\n    async createFactoryFloor() {\n        // Realistic concrete floor with wear patterns\n        const floorGeometry = new THREE.PlaneGeometry(100, 60, 50, 30);\n        \n        // Create procedural floor texture\n        const floorMaterial = this.createFloorMaterial();\n        \n        this.factoryEnvironment.floor = new THREE.Mesh(floorGeometry, floorMaterial);\n        this.factoryEnvironment.floor.rotation.x = -Math.PI / 2;\n        this.factoryEnvironment.floor.receiveShadow = true;\n        this.factoryEnvironment.floor.position.y = 0;\n        \n        this.scene.add(this.factoryEnvironment.floor);\n        \n        // Floor markings and safety lines\n        this.addFloorMarkings();\n    }\n    \n    // ðŸ—ï¸ Create Factory Structure\n    async createFactoryStructure() {\n        // Industrial walls\n        const wallMaterial = this.createWallMaterial();\n        \n        // Back wall\n        const backWallGeometry = new THREE.PlaneGeometry(100, 12);\n        const backWall = new THREE.Mesh(backWallGeometry, wallMaterial);\n        backWall.position.set(0, 6, -30);\n        backWall.receiveShadow = true;\n        this.scene.add(backWall);\n        \n        // Side walls\n        const sideWallGeometry = new THREE.PlaneGeometry(60, 12);\n        \n        const leftWall = new THREE.Mesh(sideWallGeometry, wallMaterial);\n        leftWall.position.set(-50, 6, 0);\n        leftWall.rotation.y = Math.PI / 2;\n        leftWall.receiveShadow = true;\n        this.scene.add(leftWall);\n        \n        const rightWall = new THREE.Mesh(sideWallGeometry, wallMaterial);\n        rightWall.position.set(50, 6, 0);\n        rightWall.rotation.y = -Math.PI / 2;\n        rightWall.receiveShadow = true;\n        this.scene.add(rightWall);\n        \n        // Industrial ceiling with trusses\n        this.createIndustrialCeiling();\n    }\n    \n    // ðŸ”„ Create Advanced Conveyor Systems\n    async createConveyorSystems() {\n        const conveyorPaths = [\n            { start: [-40, 0.5, -20], end: [40, 0.5, -20], width: 2 },\n            { start: [-20, 0.5, -10], end: [20, 0.5, 10], width: 1.5 },\n            { start: [0, 0.5, 15], end: [0, 0.5, 25], width: 2 }\n        ];\n        \n        for (const path of conveyorPaths) {\n            const conveyor = this.createAdvancedConveyor(path);\n            this.factoryEnvironment.conveyorBelts.push(conveyor);\n            this.scene.add(conveyor.mesh);\n        }\n    }\n    \n    // ðŸ¤– Create Advanced Machinery Models\n    async createMachineryModels() {\n        const machineConfigs = [\n            { id: 'M001', type: 'cnc_mill', position: [-15, 0, -15], status: 'running' },\n            { id: 'M002', type: 'industrial_robot', position: [0, 0, -10], status: 'running' },\n            { id: 'M003', type: 'assembly_station', position: [15, 0, -5], status: 'maintenance' },\n            { id: 'M004', type: 'quality_scanner', position: [-10, 0, 5], status: 'running' },\n            { id: 'M005', type: 'packaging_unit', position: [10, 0, 15], status: 'running' }\n        ];\n        \n        for (const config of machineConfigs) {\n            try {\n                const machine = await this.createAdvancedMachine(config);\n                this.machines[config.id] = machine;\n                this.digitalTwins[config.id] = this.createDigitalTwin(config);\n                this.scene.add(machine.mesh);\n            } catch (error) {\n                console.warn(`âš ï¸ Failed to create machine ${config.id}:`, error);\n                // Fallback to basic machine\n                const basicMachine = this.createBasicMachine(config);\n                this.machines[config.id] = basicMachine;\n                this.scene.add(basicMachine.mesh);\n            }\n        }\n    }\n    \n    // ðŸ­ Create Advanced Machine Model\n    async createAdvancedMachine(config) {\n        const machine = {\n            id: config.id,\n            type: config.type,\n            mesh: new THREE.Group(),\n            animations: [],\n            digitalTwin: null,\n            sensors: []\n        };\n        \n        // Machine base\n        const baseGeometry = new THREE.BoxGeometry(3, 1.5, 2.5);\n        const baseMaterial = this.createMachineMaterial(config.status);\n        const baseMesh = new THREE.Mesh(baseGeometry, baseMaterial);\n        baseMesh.position.y = 0.75;\n        baseMesh.castShadow = true;\n        baseMesh.receiveShadow = true;\n        machine.mesh.add(baseMesh);\n        \n        // Machine-specific components\n        switch (config.type) {\n            case 'cnc_mill':\n                this.addCNCComponents(machine);\n                break;\n            case 'industrial_robot':\n                this.addRobotComponents(machine);\n                break;\n            case 'assembly_station':\n                this.addAssemblyComponents(machine);\n                break;\n            case 'quality_scanner':\n                this.addScannerComponents(machine);\n                break;\n            case 'packaging_unit':\n                this.addPackagingComponents(machine);\n                break;\n        }\n        \n        // Position machine\n        machine.mesh.position.set(...config.position);\n        \n        // Add status indicator\n        this.addMachineStatusIndicator(machine, config.status);\n        \n        // Add sensors\n        this.addMachineSensors(machine);\n        \n        // Set up machine animations\n        this.setupMachineAnimations(machine, config.status);\n        \n        return machine;\n    }\n    \n    // ðŸŽ¬ Animation System\n    animate() {\n        this.animationId = requestAnimationFrame(() => this.animate());\n        \n        const deltaTime = this.clock.getDelta();\n        \n        // Update controls\n        if (this.controls) {\n            this.controls.update();\n        }\n        \n        // Update machine animations\n        this.updateMachineAnimations(deltaTime);\n        \n        // Update conveyor belt animations\n        this.updateConveyorAnimations(deltaTime);\n        \n        // Update particle systems\n        this.updateParticleSystems(deltaTime);\n        \n        // Update digital twin data visualization\n        this.updateDigitalTwinVisualization(deltaTime);\n        \n        // Update environmental effects\n        this.updateEnvironmentalEffects(deltaTime);\n        \n        // Performance monitoring\n        this.monitorPerformance();\n        \n        // Render scene\n        if (this.postProcessing.enabled && this.postProcessing.composer) {\n            this.postProcessing.composer.render();\n        } else {\n            this.renderer.render(this.scene, this.camera);\n        }\n    }\n    \n    // ðŸ”— Initialize Digital Twin Connections\n    async initializeDigitalTwinConnections() {\n        console.log('ðŸ”— Initializing digital twin connections...');\n        \n        try {\n            // Connect to Azure Digital Twins\n            this.dataStreams.azure_digital_twins = await this.connectToAzureDigitalTwins();\n            \n            // Connect to IoT Hub for real-time sensor data\n            this.dataStreams.iot_hub = await this.connectToIoTHub();\n            \n            // Initialize ML prediction streams\n            this.dataStreams.ml_predictions = await this.initializeMlStreams();\n            \n            // Connect to health modeling system\n            this.dataStreams.health_modeling = await this.connectToHealthModeling();\n            \n            console.log('âœ… Digital twin connections established');\n            \n        } catch (error) {\n            console.error('âŒ Digital twin connection failed:', error);\n            // Use simulation data\n            this.initializeSimulationData();\n        }\n    }\n    \n    // ðŸ“¡ Real-time Data Synchronization\n    startRealTimeSync() {\n        console.log('ðŸ“¡ Starting real-time data synchronization...');\n        \n        // Update machine states every 1 second\n        setInterval(() => {\n            this.syncMachineStates();\n        }, 1000);\n        \n        // Update sensor data every 2 seconds\n        setInterval(() => {\n            this.syncSensorData();\n        }, 2000);\n        \n        // Update production metrics every 5 seconds\n        setInterval(() => {\n            this.syncProductionMetrics();\n        }, 5000);\n        \n        // Update health model data every 10 seconds\n        setInterval(() => {\n            this.syncHealthModelData();\n        }, 10000);\n    }\n    \n    // ðŸ“Š Update Digital Twin Visualization\n    updateDigitalTwinVisualization(deltaTime) {\n        // Update machine status indicators\n        Object.values(this.machines).forEach(machine => {\n            const digitalTwin = this.digitalTwins[machine.id];\n            if (digitalTwin) {\n                this.updateMachineVisualization(machine, digitalTwin);\n            }\n        });\n        \n        // Update sensor visualizations\n        Object.values(this.sensors).forEach(sensor => {\n            this.updateSensorVisualization(sensor, deltaTime);\n        });\n        \n        // Update health status visualizations\n        this.updateHealthStatusVisualization();\n    }\n    \n    // ðŸŽ¨ Material Creation Functions\n    createFloorMaterial() {\n        const material = new THREE.MeshLambertMaterial({\n            color: 0x444444,\n            map: this.createConcreteTexture()\n        });\n        return material;\n    }\n    \n    createMachineMaterial(status) {\n        const baseColor = this.getStatusColor(status);\n        const material = new THREE.MeshPhongMaterial({\n            color: baseColor,\n            shininess: 100,\n            specular: 0x111111\n        });\n        return material;\n    }\n    \n    getStatusColor(status) {\n        const statusColors = {\n            'running': 0x00ff88,\n            'idle': 0xffaa00,\n            'maintenance': 0xff4757,\n            'offline': 0x888888,\n            'warning': 0xffa502\n        };\n        return statusColors[status] || 0x888888;\n    }\n    \n    // ðŸ”„ Machine Animation Updates\n    updateMachineAnimations(deltaTime) {\n        Object.values(this.machines).forEach(machine => {\n            if (machine.animations && machine.animations.length > 0) {\n                machine.animations.forEach(animation => {\n                    if (animation.mixer) {\n                        animation.mixer.update(deltaTime);\n                    }\n                });\n            }\n            \n            // Custom machine-specific animations\n            this.updateMachineSpecificAnimations(machine, deltaTime);\n        });\n    }\n    \n    // ðŸŽ® Enhanced User Interaction\n    setupMachineInteraction() {\n        const raycaster = new THREE.Raycaster();\n        const mouse = new THREE.Vector2();\n        \n        this.renderer.domElement.addEventListener('click', (event) => {\n            // Calculate mouse position in normalized device coordinates\n            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\n            mouse.y = -(event.clientY / (window.innerHeight - 80)) * 2 + 1;\n            \n            raycaster.setFromCamera(mouse, this.camera);\n            \n            // Check for intersections with machine meshes\n            const machineObjects = Object.values(this.machines).map(m => m.mesh);\n            const intersects = raycaster.intersectObjects(machineObjects, true);\n            \n            if (intersects.length > 0) {\n                const selectedObject = intersects[0].object;\n                const machineId = this.findMachineIdFromObject(selectedObject);\n                if (machineId) {\n                    this.selectMachine(machineId);\n                }\n            }\n        });\n    }\n    \n    // ðŸŽ¯ Machine Selection\n    selectMachine(machineId) {\n        console.log(`ðŸŽ¯ Selected machine: ${machineId}`);\n        \n        // Deselect previous machine\n        if (this.selectedMachine) {\n            this.deselectMachine(this.selectedMachine);\n        }\n        \n        this.selectedMachine = machineId;\n        const machine = this.machines[machineId];\n        \n        if (machine) {\n            // Highlight selected machine\n            this.highlightMachine(machine);\n            \n            // Show machine information panel\n            this.showMachineInfoPanel(machineId);\n            \n            // Focus camera on machine\n            this.focusCameraOnMachine(machine);\n        }\n    }\n    \n    // ðŸ“± Responsive Design\n    handleWindowResize() {\n        const width = window.innerWidth;\n        const height = window.innerHeight - 80;\n        \n        // Update camera aspect ratio\n        this.camera.aspect = width / height;\n        this.camera.updateProjectionMatrix();\n        \n        // Update renderer size\n        this.renderer.setSize(width, height);\n        \n        // Update post-processing\n        if (this.postProcessing.composer) {\n            this.postProcessing.composer.setSize(width, height);\n        }\n        \n        // Update UI elements\n        this.updateUIElementsForScreenSize();\n    }\n    \n    // ðŸŽ¬ Smooth Camera Transitions\n    focusCameraOnMachine(machine) {\n        if (!machine || !machine.mesh) return;\n        \n        const targetPosition = machine.mesh.position.clone();\n        targetPosition.add(new THREE.Vector3(5, 3, 5));\n        \n        // Smooth camera transition using TWEEN.js (if available)\n        if (typeof TWEEN !== 'undefined') {\n            new TWEEN.Tween(this.camera.position)\n                .to(targetPosition, 1500)\n                .easing(TWEEN.Easing.Cubic.Out)\n                .start();\n                \n            new TWEEN.Tween(this.controls.target)\n                .to(machine.mesh.position, 1500)\n                .easing(TWEEN.Easing.Cubic.Out)\n                .start();\n        } else {\n            // Fallback to immediate positioning\n            this.camera.position.copy(targetPosition);\n            if (this.controls) {\n                this.controls.target.copy(machine.mesh.position);\n                this.controls.update();\n            }\n        }\n    }\n    \n    // ðŸš€ Performance Optimization\n    monitorPerformance() {\n        // Simple FPS counter\n        this.performance.current_fps = 1 / this.clock.getDelta();\n        \n        // Adaptive quality based on performance\n        if (this.performance.current_fps < this.performance.target_fps * 0.8) {\n            this.reduceQuality();\n        } else if (this.performance.current_fps > this.performance.target_fps * 1.2) {\n            this.increaseQuality();\n        }\n    }\n    \n    // ðŸ“Š Digital Twin Data Update\n    updateDigitalTwinData(machineId, data) {\n        if (this.digitalTwins[machineId]) {\n            Object.assign(this.digitalTwins[machineId], data);\n            \n            // Trigger visual updates\n            this.updateMachineVisualization(this.machines[machineId], this.digitalTwins[machineId]);\n        }\n    }\n    \n    // ðŸ§¹ Cleanup\n    dispose() {\n        if (this.animationId) {\n            cancelAnimationFrame(this.animationId);\n        }\n        \n        // Cleanup Three.js resources\n        this.scene.traverse((object) => {\n            if (object.geometry) object.geometry.dispose();\n            if (object.material) {\n                if (Array.isArray(object.material)) {\n                    object.material.forEach(material => material.dispose());\n                } else {\n                    object.material.dispose();\n                }\n            }\n        });\n        \n        if (this.renderer) {\n            this.renderer.dispose();\n        }\n        \n        console.log('ðŸ§¹ 3D system cleaned up');\n    }\n    \n    // ðŸ“ˆ Demo and Fallback Methods\n    createBasicFactoryEnvironment() {\n        console.log('ðŸ­ Creating basic factory environment...');\n        \n        // Simple floor\n        const floorGeometry = new THREE.PlaneGeometry(50, 30);\n        const floorMaterial = new THREE.MeshLambertMaterial({ color: 0x444444 });\n        const floor = new THREE.Mesh(floorGeometry, floorMaterial);\n        floor.rotation.x = -Math.PI / 2;\n        floor.receiveShadow = true;\n        this.scene.add(floor);\n        \n        // Basic machines\n        this.createBasicMachines();\n    }\n    \n    createBasicMachines() {\n        const machinePositions = [\n            { id: 'M001', pos: [-10, 1, -5] },\n            { id: 'M002', pos: [0, 1, 0] },\n            { id: 'M003', pos: [10, 1, 5] }\n        ];\n        \n        machinePositions.forEach(({ id, pos }) => {\n            const geometry = new THREE.BoxGeometry(2, 2, 1.5);\n            const material = new THREE.MeshLambertMaterial({ color: 0x00ff88 });\n            const mesh = new THREE.Mesh(geometry, material);\n            mesh.position.set(...pos);\n            mesh.castShadow = true;\n            mesh.receiveShadow = true;\n            \n            this.machines[id] = { id, mesh, animations: [] };\n            this.scene.add(mesh);\n        });\n    }\n    \n    // Initialize basic mode as fallback\n    initBasicMode() {\n        console.log('ðŸ”„ Initializing basic 3D mode...');\n        this.setupScene();\n        this.setupLighting();\n        this.setupCamera();\n        this.setupRenderer();\n        this.setupControls();\n        this.createBasicFactoryEnvironment();\n        this.animate();\n    }\n}\n\n// ðŸš€ Auto-initialize when loaded\nif (typeof window !== 'undefined') {\n    window.AdvancedSmartFactory3D = AdvancedSmartFactory3D;\n    \n    // Replace the old class with the new one\n    window.SmartFactory3D = AdvancedSmartFactory3D;\n    \n    console.log('âœ… Advanced Smart Factory 3D class loaded and ready');\n}