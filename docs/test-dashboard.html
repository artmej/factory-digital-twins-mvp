<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè≠ Smart Factory Test Dashboard - No Auth</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .card h3 {
            margin: 0 0 15px 0;
            color: #00ff88;
        }
        .metric {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin: 5px 0;
        }
        .status.online { background: #00ff88; color: #000; }
        .status.warning { background: #ffaa00; color: #000; }
        .status.offline { background: #ff6b6b; color: #fff; }
        .test-button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: bold;
        }
        .test-button:hover {
            background: #00dd77;
        }
        .api-status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .api-success { background: rgba(0, 255, 136, 0.2); }
        .api-error { background: rgba(255, 107, 107, 0.2); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè≠ Smart Factory Test Dashboard</h1>
        <p>Dashboard sin autenticaci√≥n para probar APIs y funcionalidad b√°sica</p>
        
        <div class="card">
            <h3>üß™ API Testing</h3>
            <button class="test-button" onclick="testMainAPI()">Test Main API</button>
            <button class="test-button" onclick="testMLAPIs()">Test ML APIs</button>
            <button class="test-button" onclick="validateAzureConnection()">Validate Azure APIs</button>
            <div id="api-results"></div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h3>üè≠ Factory Status</h3>
                <div class="metric" id="factory-efficiency">88%</div>
                <div>Overall Equipment Effectiveness</div>
                <div class="status online">OPERATIONAL</div>
            </div>

            <div class="card">
                <h3>ü§ñ Machines Status</h3>
                <div id="machines-status">
                    <div>LINE_1_CNC_01: <span class="status online">ONLINE</span></div>
                    <div>LINE_1_ROBOT_01: <span class="status online">ONLINE</span></div>
                    <div>LINE_1_CONV_01: <span class="status warning">WARNING</span></div>
                    <div>LINE_2_CNC_02: <span class="status online">ONLINE</span></div>
                    <div>LINE_2_ROBOT_02: <span class="status online">ONLINE</span></div>
                    <div>LINE_2_CONV_02: <span class="status online">ONLINE</span></div>
                    <div>LINE_3_CNC_03: <span class="status online">ONLINE</span></div>
                    <div>LINE_3_ROBOT_03: <span class="status warning">WARNING</span></div>
                    <div>LINE_3_CONV_03: <span class="status online">ONLINE</span></div>
                </div>
            </div>

            <div class="card">
                <h3>üîß Maintenance Predictions</h3>
                <div id="maintenance-data">
                    <div>Next maintenance in: <strong>3 days</strong></div>
                    <div>Predicted confidence: <strong>87%</strong></div>
                    <div>Critical machines: <strong>2</strong></div>
                </div>
            </div>

            <div class="card">
                <h3>‚ö° Energy Efficiency</h3>
                <div class="metric" id="energy-efficiency">92%</div>
                <div>Current power usage: <strong>450 kW</strong></div>
                <div>Optimization potential: <strong>8%</strong></div>
            </div>
        </div>
    </div>

    <script>
        // Environment Detection - GitHub Pages vs Azure Production  
        const IS_DEVELOPMENT = window.location.hostname.includes('github.io') || window.location.hostname === 'localhost';
        const ENVIRONMENT = IS_DEVELOPMENT ? 'DEVELOPMENT' : 'PRODUCTION';
        
        // Configuration
        const API_CONFIG = {
            mainAPI: IS_DEVELOPMENT ? null : 'https://smartfactory-ml-api.azurewebsites.net',
            fallbackAPI: IS_DEVELOPMENT ? null : 'https://smartfactory-pwa-func-prod.azurewebsites.net/api',
            timeout: 10000,
            environment: ENVIRONMENT
        };

        // Test main API endpoint
        async function testMainAPI() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="api-status">üîÑ Testing main API...</div>';

            try {
                const response = await fetch(`${API_CONFIG.mainAPI}/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    resultsDiv.innerHTML = `
                        <div class="api-status api-success">
                            ‚úÖ Main API: WORKING<br>
                            Status: ${response.status}<br>
                            Response: ${JSON.stringify(data, null, 2)}
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="api-status api-error">
                            ‚ùå Main API: ERROR ${response.status}<br>
                            ${response.statusText}
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="api-status api-error">
                        ‚ùå Main API: CONNECTION FAILED<br>
                        Error: ${error.message}
                    </div>
                `;
                
                // Try fallback API
                tryFallbackAPI();
            }
        }

        // Try fallback API
        async function tryFallbackAPI() {
            try {
                const response = await fetch(`${API_CONFIG.fallbackAPI}/dashboard`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('api-results').innerHTML += `
                        <div class="api-status api-success">
                            ‚úÖ Fallback API: WORKING<br>
                            Status: ${response.status}<br>
                            Data received: ${Object.keys(data).length} properties
                        </div>
                    `;
                } else {
                    document.getElementById('api-results').innerHTML += `
                        <div class="api-status api-error">
                            ‚ùå Fallback API: ERROR ${response.status}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('api-results').innerHTML += `
                    <div class="api-status api-error">
                        ‚ùå Fallback API: CONNECTION FAILED<br>
                        Error: ${error.message}
                    </div>
                `;
            }
        }

        // Test ML APIs
        async function testMLAPIs() {
            const resultsDiv = document.getElementById('api-results');
            resultsDiv.innerHTML = '<div class="api-status">üîÑ Testing ML APIs...</div>';

            const mlEndpoints = [
                '/predict/maintenance',
                '/predict/quality',
                '/predict/energy',
                '/predict/anomaly'
            ];

            let results = [];

            for (const endpoint of mlEndpoints) {
                try {
                    const response = await fetch(`${API_CONFIG.mainAPI}${endpoint}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            deviceId: 'LINE_1_CNC_01',
                            temperature: 72,
                            vibration: 0.5,
                            pressure: 105
                        })
                    });

                    if (response.ok) {
                        const data = await response.json();
                        results.push(`‚úÖ ${endpoint}: ${response.status} - Confidence: ${data.confidence || 'N/A'}%`);
                    } else {
                        results.push(`‚ùå ${endpoint}: ERROR ${response.status}`);
                    }
                } catch (error) {
                    results.push(`‚ùå ${endpoint}: CONNECTION FAILED`);
                }
            }

            resultsDiv.innerHTML = `
                <div class="api-status ${results.some(r => r.includes('‚úÖ')) ? 'api-success' : 'api-error'}">
                    <strong>ML APIs Results:</strong><br>
                    ${results.join('<br>')}
                </div>
            `;
        }

        // Validate Azure APIs - Environment Aware
        async function validateAzureAPIs() {
            const resultsDiv = document.getElementById('api-results');
            
            if (IS_DEVELOPMENT) {
                // Development mode - clear informative status
                resultsDiv.innerHTML = `
                    <div class="api-status api-success">
                        üîß <strong>DEVELOPMENT ENVIRONMENT</strong><br>
                        üìç Platform: ${window.location.hostname}<br>
                        üîê Auth: Microsoft MSAL Ready<br>
                        ‚ö†Ô∏è Azure APIs: Not available in dev<br>
                        ‚úÖ Integration Compliance: Ready<br>
                        üöÄ Status: Deployment Ready<br>
                        üïê Checked: ${new Date().toLocaleTimeString()}
                    </div>
                `;
                
                document.getElementById('factory-efficiency').textContent = 'Dev Environment';
                document.getElementById('energy-efficiency').textContent = 'Azure Required';
                return;
            }
            
            // Production mode - test real Azure APIs
            resultsDiv.innerHTML = `
                <div class="api-status api-warning">
                    üîÑ Testing PRODUCTION Azure APIs<br>
                    üîí Environment: ${ENVIRONMENT}<br>
                    Integration phase validation in progress...<br>
                    Timestamp: ${new Date().toLocaleTimeString()}
                </div>
            `;
            
            try {
                // Test real Azure endpoints
                const azureTests = await Promise.all([
                    fetch(`${API_CONFIG.mainAPI}/health`),
                    fetch('/api/cosmos/health'),
                    fetch('/api/digitaltwins/health')
                ]);
                
                const successCount = azureTests.filter(r => r.ok).length;
                
                document.getElementById('factory-efficiency').textContent = 'Real APIs Required';
                document.getElementById('energy-efficiency').textContent = 'Azure Only';
                
                resultsDiv.innerHTML = `
                    <div class="api-status ${successCount === 3 ? 'api-success' : 'api-error'}">
                        ${successCount === 3 ? '‚úÖ' : '‚ùå'} Azure API Validation: ${successCount}/3 services<br>
                        üîí Integration Mode: Active<br>
                        üöÄ Environment: Production<br>
                        üö´ Mock Data: Permanently Disabled<br>
                        üìß Contact admin if services fail<br>
                        Timestamp: ${new Date().toLocaleTimeString()}
                    </div>
                `;
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="api-status api-error">
                        ‚ùå Production Azure validation failed<br>
                        üîí Integration phase requires real APIs<br>
                        üìß Azure service configuration needed<br>
                        Error: ${error.message}<br>
                        Timestamp: ${new Date().toLocaleTimeString()}
                    </div>
                `;
            }
        }

        // Auto-test APIs on load
        window.addEventListener('load', () => {
            console.log('üè≠ Factory Test Dashboard loaded');
            setTimeout(testMainAPI, 1000);
        });

        // Update data every 30 seconds with real Azure validation
        setInterval(() => {
            validateAzureAPIs();
        }, 30000);
    </script>
</body>
</html>