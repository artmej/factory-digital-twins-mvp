<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè≠ Smart Factory 3D - GitHub Pages</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            overflow: hidden;
            color: white;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #threejs-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* Enhanced HUD */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #00ff88;
            min-width: 350px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .hud-title {
            font-size: 20px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 15px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .metric-label {
            color: #ccc;
            font-weight: 500;
        }
        
        .metric-value {
            color: #fff;
            font-weight: bold;
            position: relative;
        }
        
        .metric-value.good { color: #00ff88; }
        .metric-value.warning { color: #ffd93d; }
        .metric-value.critical { color: #ff6b6b; }
        
        /* Azure Status Indicator */
        #azure-status {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #0078d4;
            font-size: 12px;
        }
        
        .azure-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .azure-indicator.online {
            background: #00ff88;
            box-shadow: 0 0 5px #00ff88;
        }
        
        .azure-indicator.offline {
            background: #ff6b6b;
        }
        
        /* Bottom Controls */
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 25px;
            border: 1px solid #00ff88;
        }
        
        .control-btn {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(0, 255, 136, 0.4);
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            background: #00ff88;
            color: #000;
        }
        
        /* Loading Screen */
        #loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-left: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="threejs-container"></div>
        
        <div id="loading">
            <div class="spinner"></div>
            <h3>üè≠ Loading Smart Factory...</h3>
            <p>Connecting to Azure ML Services...</p>
        </div>
        
        <div id="hud">
            <div class="hud-title">
                üè≠ Smart Factory 3D GitHub Pages
            </div>
            <div class="metric">
                <span class="metric-label">üöÄ Production:</span>
                <span class="metric-value good" id="production">95.2%</span>
            </div>
            <div class="metric">
                <span class="metric-label">‚ö° Efficiency:</span>
                <span class="metric-value good" id="efficiency">93.8%</span>
            </div>
            <div class="metric">
                <span class="metric-label">ü§ñ Machines:</span>
                <span class="metric-value good">5/5 Online</span>
            </div>
            <div class="metric">
                <span class="metric-label">üîÆ ML Status:</span>
                <span class="metric-value good" id="ml-status">Azure Connected</span>
            </div>
        </div>
        
        <div id="azure-status">
            <span class="azure-indicator online"></span>
            <span>Azure Functions: Connected</span>
        </div>
        
        <div id="controls">
            <button class="control-btn active" onclick="resetCamera()">üìπ Reset View</button>
            <button class="control-btn" onclick="toggleAnimation()">üé¨ Animation</button>
            <button class="control-btn" onclick="toggleLabels()">üè∑Ô∏è Labels</button>
        </div>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // üè≠ Smart Factory 3D Dashboard - GitHub Pages
        const AZURE_FUNCTION_URL = 'https://smartfactory-prod-func-blue.azurewebsites.net/api/ml';
        
        let scene, camera, renderer, machines = {};
        let animationEnabled = true, labelsVisible = true;
        
        function init3D() {
            console.log('üè≠ Initializing Smart Factory 3D on GitHub Pages...');
            
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            scene.fog = new THREE.Fog(0x1a1a2e, 15, 60);
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(20, 15, 20);
            camera.lookAt(0, 0, 0);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            document.getElementById('threejs-container').appendChild(renderer.domElement);
            
            createLighting();
            createFactory();
            createMachines();
            setupControls();
            
            setTimeout(() => document.getElementById('loading').style.display = 'none', 2000);
            
            animate();
            console.log('‚úÖ 3D Factory ready!');
        }
        
        function createLighting() {
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            const mainLight = new THREE.DirectionalLight(0xffffff, 0.8);
            mainLight.position.set(20, 30, 20);
            mainLight.castShadow = true;
            scene.add(mainLight);
            
            const greenLight = new THREE.PointLight(0x00ff88, 0.6, 25);
            greenLight.position.set(-12, 8, -8);
            scene.add(greenLight);
            
            const blueLight = new THREE.PointLight(0x4ecdc4, 0.6, 25);
            blueLight.position.set(12, 8, 8);
            scene.add(blueLight);
        }
        
        function createFactory() {
            // Floor
            const floor = new THREE.Mesh(
                new THREE.PlaneGeometry(40, 35),
                new THREE.MeshStandardMaterial({ color: 0x2a2a2a, roughness: 0.8 })
            );
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -1.5;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Grid
            const gridHelper = new THREE.GridHelper(40, 25, 0x00ff88, 0x333333);
            gridHelper.position.y = -1.4;
            scene.add(gridHelper);
            
            // Walls
            const wallMaterial = new THREE.MeshStandardMaterial({ color: 0x2c3e50 });
            
            const backWall = new THREE.Mesh(new THREE.PlaneGeometry(40, 12), wallMaterial);
            backWall.position.set(0, 4.5, -17.5);
            scene.add(backWall);
            
            const leftWall = new THREE.Mesh(new THREE.PlaneGeometry(35, 12), wallMaterial);
            leftWall.rotation.y = Math.PI / 2;
            leftWall.position.set(-20, 4.5, 0);
            scene.add(leftWall);
            
            const rightWall = new THREE.Mesh(new THREE.PlaneGeometry(35, 12), wallMaterial);
            rightWall.rotation.y = -Math.PI / 2;
            rightWall.position.set(20, 4.5, 0);
            scene.add(rightWall);
        }
        
        function createMachines() {
            const configs = [
                { id: 'cnc', name: 'üîß CNC Mill', pos: [-8, 0, -8], color: 0x2ecc71 },
                { id: 'robot', name: 'ü§ñ Robot Arm', pos: [8, 0, -8], color: 0x3498db },
                { id: 'quality', name: 'üîç Quality Control', pos: [0, 0, 0], color: 0x9b59b6 },
                { id: 'package', name: 'üì¶ Packaging', pos: [-8, 0, 8], color: 0xe74c3c },
                { id: 'laser', name: '‚ö° Laser Cutter', pos: [8, 0, 8], color: 0xf39c12 }
            ];
            
            configs.forEach(config => createMachine(config));
        }
        
        function createMachine(config) {
            const group = new THREE.Group();
            
            // Main body
            const body = new THREE.Mesh(
                new THREE.BoxGeometry(4, 3, 3),
                new THREE.MeshStandardMaterial({ color: config.color, metalness: 0.7, roughness: 0.3 })
            );
            body.position.y = 1.5;
            body.castShadow = true;
            group.add(body);
            
            // Base
            const base = new THREE.Mesh(
                new THREE.BoxGeometry(4.5, 0.5, 3.5),
                new THREE.MeshStandardMaterial({ color: 0x34495e, metalness: 0.8 })
            );
            base.position.y = -1.25;
            base.castShadow = true;
            group.add(base);
            
            // Status indicator
            const indicator = new THREE.Mesh(
                new THREE.SphereGeometry(0.2, 12, 8),
                new THREE.MeshBasicMaterial({ color: 0x00ff88, transparent: true, opacity: 0.9 })
            );
            indicator.position.set(0, 4, 0);
            group.add(indicator);
            
            // Label
            if (labelsVisible) {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 512;
                canvas.height = 128;
                
                context.fillStyle = 'rgba(0, 0, 0, 0.8)';
                context.fillRect(0, 0, canvas.width, canvas.height);
                context.fillStyle = '#ffffff';
                context.font = 'bold 32px Arial';
                context.textAlign = 'center';
                context.fillText(config.name, canvas.width / 2, canvas.height / 2 + 8);
                
                const texture = new THREE.CanvasTexture(canvas);
                const label = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture }));
                label.position.set(0, 6, 0);
                label.scale.set(6, 1.5, 1);
                group.add(label);
            }
            
            // Position
            group.position.set(...config.pos);
            group.userData = { type: 'machine', config };
            
            machines[config.id] = group;
            scene.add(group);
        }
        
        function setupControls() {
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                isMouseDown = true;
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (!isMouseDown) return;
                
                const deltaX = e.clientX - mouseX;
                const deltaY = e.clientY - mouseY;
                
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaX * 0.01;
                spherical.phi += deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                
                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);
                
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            renderer.domElement.addEventListener('mouseup', () => isMouseDown = false);
            
            renderer.domElement.addEventListener('wheel', (e) => {
                const distance = camera.position.length();
                const newDistance = distance + e.deltaY * 0.02;
                camera.position.normalize().multiplyScalar(Math.max(8, Math.min(80, newDistance)));
            });
        }
        
        function resetCamera() {
            camera.position.set(20, 15, 20);
            camera.lookAt(0, 0, 0);
        }
        
        function toggleAnimation() {
            animationEnabled = !animationEnabled;
            event.target.classList.toggle('active');
            event.target.textContent = animationEnabled ? 'üé¨ Animation' : '‚è∏Ô∏è Paused';
        }
        
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            event.target.classList.toggle('active');
            Object.values(machines).forEach(machine => {
                const label = machine.children.find(child => child instanceof THREE.Sprite);
                if (label) label.visible = labelsVisible;
            });
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (animationEnabled) {
                Object.values(machines).forEach(machine => {
                    machine.rotation.y += 0.002;
                    const indicator = machine.children.find(child => 
                        child.geometry instanceof THREE.SphereGeometry
                    );
                    if (indicator) indicator.rotation.y += 0.1;
                });
            }
            
            renderer.render(scene, camera);
        }
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        window.addEventListener('load', init3D);
    </script>
</body>
</html>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            overflow: hidden;
            color: white;
        }
        
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        
        #threejs-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        /* Enhanced HUD */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #00ff88;
            min-width: 350px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .hud-title {
            font-size: 20px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 15px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .metric-label {
            color: #ccc;
            font-weight: 500;
        }
        
        .metric-value {
            color: #fff;
            font-weight: bold;
            position: relative;
        }
        
        .metric-value.good { color: #00ff88; }
        .metric-value.warning { color: #ffd93d; }
        .metric-value.critical { color: #ff6b6b; }
        
        .metric-value.pulsing {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        /* Machine Details Panel */
        #machine-details {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #4ecdc4;
            min-width: 300px;
            backdrop-filter: blur(10px);
            display: none;
        }
        
        .details-title {
            font-size: 18px;
            font-weight: bold;
            color: #4ecdc4;
            margin-bottom: 15px;
        }
        
        .prediction-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 14px;
        }
        
        /* Bottom Controls */
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            gap: 15px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 25px;
            border-radius: 25px;
            border: 1px solid #00ff88;
        }
        
        .control-btn {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border: 1px solid #00ff88;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(0, 255, 136, 0.4);
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            background: #00ff88;
            color: #000;
        }
        
        /* Loading Screen */
        #loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-left: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status-indicator {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid rgba(0, 0, 0, 0.8);
        }
        
        .status-indicator.online {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
            animation: blink 2s infinite;
        }
        
        .status-indicator.warning {
            background: #ffd93d;
            box-shadow: 0 0 10px #ffd93d;
        }
        
        .status-indicator.critical {
            background: #ff6b6b;
            box-shadow: 0 0 10px #ff6b6b;
            animation: pulse 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="threejs-container"></div>
        
        <div id="loading">
            <div class="spinner"></div>
            <h3>üè≠ Loading Smart Factory...</h3>
            <p>Initializing 3D environment...</p>
        </div>
        
        <div id="hud">
            <div class="hud-title">
                üè≠ Smart Factory Overview
                <div class="status-indicator online"></div>
            </div>
            <div class="metric">
                <span class="metric-label">üöÄ Production Rate:</span>
                <span class="metric-value good" id="production">98.5%</span>
            </div>
            <div class="metric">
                <span class="metric-label">‚ö° Overall Efficiency:</span>
                <span class="metric-value good" id="efficiency">94.2%</span>
            </div>
            <div class="metric">
                <span class="metric-label">üå°Ô∏è Avg Temperature:</span>
                <span class="metric-value" id="temperature">72¬∞C</span>
            </div>
            <div class="metric">
                <span class="metric-label">‚ö†Ô∏è Active Alerts:</span>
                <span class="metric-value warning" id="alerts">2 Active</span>
            </div>
            <div class="metric">
                <span class="metric-label">ü§ñ Machines Online:</span>
                <span class="metric-value good" id="machines">12/12</span>
            </div>
            <div class="metric">
                <span class="metric-label">üîÆ ML Predictions:</span>
                <span class="metric-value" id="ml-status">Active</span>
            </div>
        </div>
        
        <div id="machine-details">
            <div class="details-title">ü§ñ Machine Details</div>
            <div id="machine-name">Select a machine...</div>
            <div id="predictions-container"></div>
        </div>
        
        <div id="controls">
            <button class="control-btn active" onclick="resetCamera()">üìπ Reset View</button>
            <button class="control-btn" onclick="toggleAnimation()">üé¨ Animation</button>
            <button class="control-btn" onclick="toggleLabels()">üè∑Ô∏è Labels</button>
            <button class="control-btn" onclick="toggleWireframe()">üî≤ Wireframe</button>
        </div>
    </div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // üè≠ Enhanced Smart Factory 3D Dashboard
        let scene, camera, renderer, machines = {}, sensors = {}, selectedMachine = null;
        let animationEnabled = true, labelsVisible = true, wireframeMode = false;
        
        // Initialize 3D Scene
        function init3D() {
            console.log('üè≠ Initializing Enhanced Smart Factory 3D...');
            
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            scene.fog = new THREE.Fog(0x1a1a2e, 15, 60);
            
            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(20, 15, 20);
            camera.lookAt(0, 0, 0);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.setClearColor(0x1a1a2e);
            
            document.getElementById('threejs-container').appendChild(renderer.domElement);
            
            // Enhanced lighting
            setupLighting();
            
            // Create factory environment
            createFactoryEnvironment();
            
            // Create realistic machines
            createRealisticMachines();
            
            // Setup controls
            setupControls();
            
            // Start animation
            animate();
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 2000);
            
            // Start real-time updates
            startRealTimeUpdates();
            
            console.log('‚úÖ Enhanced 3D Factory ready!');
        }
        
        // Enhanced lighting system
        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);
            
            // Main directional light (sun)
            const mainLight = new THREE.DirectionalLight(0xffffff, 0.8);
            mainLight.position.set(20, 30, 20);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 2048;
            mainLight.shadow.mapSize.height = 2048;
            mainLight.shadow.camera.near = 0.1;
            mainLight.shadow.camera.far = 100;
            mainLight.shadow.camera.left = -30;
            mainLight.shadow.camera.right = 30;
            mainLight.shadow.camera.top = 30;
            mainLight.shadow.camera.bottom = -30;
            scene.add(mainLight);
            
            // Factory accent lights
            const greenAccent = new THREE.PointLight(0x00ff88, 0.6, 25);
            greenAccent.position.set(-12, 8, -8);
            scene.add(greenAccent);
            
            const blueAccent = new THREE.PointLight(0x4ecdc4, 0.6, 25);
            blueAccent.position.set(12, 8, 8);
            scene.add(blueAccent);
            
            const orangeAccent = new THREE.PointLight(0xffa500, 0.4, 20);
            orangeAccent.position.set(0, 12, -15);
            scene.add(orangeAccent);
        }
        
        // Create realistic factory environment
        function createFactoryEnvironment() {
            // Enhanced factory floor with texture
            const floorGeometry = new THREE.PlaneGeometry(40, 35);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x2a2a2a,
                roughness: 0.8,
                metalness: 0.1
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.position.y = -1.5;
            floor.receiveShadow = true;
            scene.add(floor);
            
            // Factory walls with industrial look
            createFactoryWalls();
            
            // Industrial ceiling structure
            createCeilingStructure();
            
            // Grid helper for reference
            const gridHelper = new THREE.GridHelper(40, 25, 0x00ff88, 0x333333);
            gridHelper.position.y = -1.4;
            scene.add(gridHelper);
            
            // Conveyor belts
            createConveyorBelts();
        }
        
        // Create factory walls
        function createFactoryWalls() {
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x2c3e50,
                roughness: 0.7,
                metalness: 0.2
            });
            
            // Back wall
            const backWall = new THREE.Mesh(new THREE.PlaneGeometry(40, 12), wallMaterial);
            backWall.position.set(0, 4.5, -17.5);
            backWall.receiveShadow = true;
            scene.add(backWall);
            
            // Side walls
            const leftWall = new THREE.Mesh(new THREE.PlaneGeometry(35, 12), wallMaterial);
            leftWall.rotation.y = Math.PI / 2;
            leftWall.position.set(-20, 4.5, 0);
            leftWall.receiveShadow = true;
            scene.add(leftWall);
            
            const rightWall = new THREE.Mesh(new THREE.PlaneGeometry(35, 12), wallMaterial);
            rightWall.rotation.y = -Math.PI / 2;
            rightWall.position.set(20, 4.5, 0);
            rightWall.receiveShadow = true;
            scene.add(rightWall);
        }
        
        // Create ceiling structure
        function createCeilingStructure() {
            const beamMaterial = new THREE.MeshStandardMaterial({
                color: 0x34495e,
                metalness: 0.8,
                roughness: 0.3
            });
            
            // Main support beams
            for (let i = -15; i <= 15; i += 10) {
                const beam = new THREE.Mesh(new THREE.BoxGeometry(40, 0.5, 0.5), beamMaterial);
                beam.position.set(0, 10, i);
                beam.castShadow = true;
                scene.add(beam);
            }
            
            // Cross beams
            for (let i = -18; i <= 18; i += 12) {
                const crossBeam = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.5, 35), beamMaterial);
                crossBeam.position.set(i, 10, 0);
                crossBeam.castShadow = true;
                scene.add(crossBeam);
            }
        }
        
        // Create conveyor belts
        function createConveyorBelts() {
            const beltMaterial = new THREE.MeshStandardMaterial({
                color: 0x1a1a1a,
                roughness: 0.9,
                metalness: 0.1
            });
            
            // Main conveyor line
            const mainBelt = new THREE.Mesh(new THREE.BoxGeometry(30, 0.2, 1.5), beltMaterial);
            mainBelt.position.set(0, -1, -5);
            mainBelt.receiveShadow = true;
            scene.add(mainBelt);
            
            // Side conveyor
            const sideBelt = new THREE.Mesh(new THREE.BoxGeometry(1.5, 0.2, 20), beltMaterial);
            sideBelt.position.set(10, -1, 5);
            sideBelt.receiveShadow = true;
            scene.add(sideBelt);
        }
        
        // Create realistic machines
        function createRealisticMachines() {
            const machineConfigs = [
                {
                    id: 'cnc-mill-01',
                    name: 'üîß CNC Milling Center',
                    position: { x: -8, y: 0, z: -8 },
                    rotation: { x: 0, y: Math.PI/4, z: 0 },
                    status: 'operational',
                    health: 87,
                    color: 0x2ecc71
                },
                {
                    id: 'robot-arm-01', 
                    name: 'ü§ñ Assembly Robot',
                    position: { x: 8, y: 0, z: -8 },
                    rotation: { x: 0, y: -Math.PI/4, z: 0 },
                    status: 'operational',
                    health: 94,
                    color: 0x3498db
                },
                {
                    id: 'quality-ctrl',
                    name: 'üîç Quality Control Station',
                    position: { x: 0, y: 0, z: 0 },
                    rotation: { x: 0, y: 0, z: 0 },
                    status: 'operational',
                    health: 91,
                    color: 0x9b59b6
                },
                {
                    id: 'packaging-unit',
                    name: 'üì¶ Packaging Unit',
                    position: { x: -8, y: 0, z: 8 },
                    rotation: { x: 0, y: Math.PI/2, z: 0 },
                    status: 'maintenance',
                    health: 42,
                    color: 0xe74c3c
                },
                {
                    id: 'laser-cutter',
                    name: '‚ö° Laser Cutting Station', 
                    position: { x: 8, y: 0, z: 8 },
                    rotation: { x: 0, y: -Math.PI/2, z: 0 },
                    status: 'operational',
                    health: 78,
                    color: 0xf39c12
                }
            ];
            
            machineConfigs.forEach(config => {
                createRealisticMachine(config);
            });
        }
        
        // Create detailed machine model
        function createRealisticMachine(config) {
            const group = new THREE.Group();
            
            // Main machine body
            const bodyGeometry = new THREE.BoxGeometry(4, 3, 3);
            const bodyMaterial = new THREE.MeshStandardMaterial({
                color: config.color,
                metalness: 0.7,
                roughness: 0.3
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 1.5;
            body.castShadow = true;
            body.receiveShadow = true;
            group.add(body);
            
            // Machine base/platform
            const baseGeometry = new THREE.BoxGeometry(4.5, 0.5, 3.5);
            const baseMaterial = new THREE.MeshStandardMaterial({
                color: 0x34495e,
                metalness: 0.8,
                roughness: 0.2
            });
            const base = new THREE.Mesh(baseGeometry, baseMaterial);
            base.position.y = -1.25;
            base.castShadow = true;
            base.receiveShadow = true;
            group.add(base);
            
            // Control panel
            const panelGeometry = new THREE.BoxGeometry(1.5, 1, 0.3);
            const panelMaterial = new THREE.MeshStandardMaterial({
                color: 0x2c3e50,
                metalness: 0.6,
                roughness: 0.4
            });
            const panel = new THREE.Mesh(panelGeometry, panelMaterial);
            panel.position.set(1.8, 1, 1.7);
            panel.castShadow = true;
            group.add(panel);
            
            // Status indicator light
            const indicatorGeometry = new THREE.SphereGeometry(0.2, 12, 8);
            const indicatorMaterial = new THREE.MeshBasicMaterial({
                color: getStatusColor(config.status),
                transparent: true,
                opacity: 0.9
            });
            const indicator = new THREE.Mesh(indicatorGeometry, indicatorMaterial);
            indicator.position.set(0, 4, 0);
            group.add(indicator);
            
            // Add some mechanical details
            createMachineDetails(group, config);
            
            // Machine label
            if (labelsVisible) {
                createMachineLabel(group, config.name);
            }
            
            // Position and store
            group.position.set(config.position.x, config.position.y, config.position.z);
            group.rotation.set(config.rotation.x, config.rotation.y, config.rotation.z);
            group.userData = { type: 'machine', data: config };
            
            machines[config.id] = group;
            scene.add(group);
            
            console.log(`‚úÖ Created machine: ${config.name}`);
        }
        
        // Add mechanical details to machines
        function createMachineDetails(group, config) {
            const detailMaterial = new THREE.MeshStandardMaterial({
                color: 0x7f8c8d,
                metalness: 0.9,
                roughness: 0.1
            });
            
            // Pipes/cables
            for (let i = 0; i < 3; i++) {
                const pipe = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.1, 0.1, 2),
                    detailMaterial
                );
                pipe.position.set(-1.5 + i * 0.3, 2.5, -1.8);
                pipe.rotation.x = Math.PI / 2;
                pipe.castShadow = true;
                group.add(pipe);
            }
            
            // Mechanical arm (for robots)
            if (config.id.includes('robot')) {
                const armSegment1 = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.2, 0.2, 2),
                    detailMaterial
                );
                armSegment1.position.set(0, 3.5, 0);
                armSegment1.castShadow = true;
                group.add(armSegment1);
                
                const armSegment2 = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.15, 0.15, 1.5),
                    detailMaterial
                );
                armSegment2.position.set(0.5, 4.5, 0.5);
                armSegment2.rotation.z = Math.PI / 6;
                armSegment2.castShadow = true;
                group.add(armSegment2);
            }
            
            // Warning stripes for maintenance
            if (config.status === 'maintenance') {
                const stripeGeometry = new THREE.BoxGeometry(0.1, 3, 0.3);
                const stripeMaterial = new THREE.MeshBasicMaterial({
                    color: 0xff6b6b
                });
                for (let i = 0; i < 4; i++) {
                    const stripe = new THREE.Mesh(stripeGeometry, stripeMaterial);
                    stripe.position.set(-2.1, 1.5, -1 + i * 0.7);
                    group.add(stripe);
                }
            }
        }
        
        // Create machine labels
        function createMachineLabel(group, text) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            
            // Background
            context.fillStyle = 'rgba(0, 0, 0, 0.8)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // Text
            context.fillStyle = '#ffffff';
            context.font = 'bold 32px Arial';
            context.textAlign = 'center';
            context.fillText(text, canvas.width / 2, canvas.height / 2 + 8);
            
            const texture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.SpriteMaterial({ map: texture });
            const label = new THREE.Sprite(labelMaterial);
            label.position.set(0, 6, 0);
            label.scale.set(6, 1.5, 1);
            
            group.add(label);
        }
        
        // Control functions
        function resetCamera() {
            camera.position.set(20, 15, 20);
            camera.lookAt(0, 0, 0);
        }
        
        function toggleAnimation() {
            animationEnabled = !animationEnabled;
            const btn = event.target;
            btn.classList.toggle('active');
            btn.textContent = animationEnabled ? 'üé¨ Animation' : '‚è∏Ô∏è Paused';
        }
        
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            const btn = event.target;
            btn.classList.toggle('active');
            // Toggle label visibility for all machines
            Object.values(machines).forEach(machine => {
                const label = machine.children.find(child => child instanceof THREE.Sprite);
                if (label) {
                    label.visible = labelsVisible;
                }
            });
        }
        
        function toggleWireframe() {
            wireframeMode = !wireframeMode;
            const btn = event.target;
            btn.classList.toggle('active');
            
            // Toggle wireframe for all machines
            scene.traverse(child => {
                if (child.isMesh && child.material) {
                    child.material.wireframe = wireframeMode;
                }
            });
        }
        
        // Mouse controls
        function setupControls() {
            let isMouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (event) => {
                isMouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            renderer.domElement.addEventListener('mousemove', (event) => {
                if (!isMouseDown) return;
                
                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;
                
                // Camera rotation
                const spherical = new THREE.Spherical();
                spherical.setFromVector3(camera.position);
                spherical.theta -= deltaX * 0.01;
                spherical.phi += deltaY * 0.01;
                spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));
                
                camera.position.setFromSpherical(spherical);
                camera.lookAt(0, 0, 0);
                
                mouseX = event.clientX;
                mouseY = event.clientY;
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                isMouseDown = false;
            });
            
            // Mouse wheel for zoom
            renderer.domElement.addEventListener('wheel', (event) => {
                const distance = camera.position.length();
                const newDistance = distance + event.deltaY * 0.02;
                camera.position.normalize().multiplyScalar(
                    Math.max(8, Math.min(80, newDistance))
                );
            });
            
            // Click to select machines
            renderer.domElement.addEventListener('click', (event) => {
                onMachineClick(event);
            });
        }
        
        // Machine selection
        function onMachineClick(event) {
            const mouse = new THREE.Vector2(
                (event.clientX / window.innerWidth) * 2 - 1,
                -(event.clientY / window.innerHeight) * 2 + 1
            );
            
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);
            
            const allMachines = Object.values(machines);
            const intersects = raycaster.intersectObjects(allMachines, true);
            
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                let machineGroup = clickedObject;
                
                // Find the parent machine group
                while (machineGroup.parent && !machineGroup.userData.type) {
                    machineGroup = machineGroup.parent;
                }
                
                if (machineGroup.userData.type === 'machine') {
                    selectMachine(machineGroup);
                }
            }
        }
        
        // Select and highlight machine
        function selectMachine(machineGroup) {
            // Clear previous selection
            if (selectedMachine) {
                selectedMachine.children[0].material.emissive.setHex(0x000000);
            }
            
            selectedMachine = machineGroup;
            const machineData = machineGroup.userData.data;
            
            // Highlight selected machine
            machineGroup.children[0].material.emissive.setHex(0x333333);
            
            // Show machine details
            showMachineDetails(machineData);
        }
        
        // Show machine details panel
        function showMachineDetails(machineData) {
            const detailsPanel = document.getElementById('machine-details');
            const nameElement = document.getElementById('machine-name');
            const predictionsContainer = document.getElementById('predictions-container');
            
            nameElement.textContent = machineData.name;
            
            // Generate realistic ML predictions
            const predictions = {
                health: machineData.health + (Math.random() - 0.5) * 10,
                failureRisk: machineData.status === 'maintenance' ? 0.8 + Math.random() * 0.15 : Math.random() * 0.3,
                anomalyScore: machineData.status === 'maintenance' ? 0.7 + Math.random() * 0.2 : Math.random() * 0.4,
                efficiency: 85 + Math.random() * 15,
                nextMaintenance: Math.floor(Math.random() * 30) + ' days'
            };
            
            predictionsContainer.innerHTML = `
                <div class="prediction-item">
                    <span>Health Score:</span>
                    <span class="${predictions.health > 70 ? 'good' : predictions.health > 40 ? 'warning' : 'critical'}">${predictions.health.toFixed(1)}%</span>
                </div>
                <div class="prediction-item">
                    <span>Failure Risk:</span>
                    <span class="${predictions.failureRisk < 0.3 ? 'good' : predictions.failureRisk < 0.6 ? 'warning' : 'critical'}">${(predictions.failureRisk * 100).toFixed(1)}%</span>
                </div>
                <div class="prediction-item">
                    <span>Anomaly Score:</span>
                    <span class="${predictions.anomalyScore < 0.3 ? 'good' : predictions.anomalyScore < 0.6 ? 'warning' : 'critical'}">${(predictions.anomalyScore * 100).toFixed(1)}%</span>
                </div>
                <div class="prediction-item">
                    <span>Efficiency:</span>
                    <span class="good">${predictions.efficiency.toFixed(1)}%</span>
                </div>
                <div class="prediction-item">
                    <span>Next Maintenance:</span>
                    <span>${predictions.nextMaintenance}</span>
                </div>
            `;
            
            detailsPanel.style.display = 'block';
        }
        
        // Real-time updates
        function startRealTimeUpdates() {
            setInterval(() => {
                // Update metrics
                document.getElementById('production').textContent = (95 + Math.random() * 8).toFixed(1) + '%';
                document.getElementById('efficiency').textContent = (88 + Math.random() * 12).toFixed(1) + '%';
                document.getElementById('temperature').textContent = (68 + Math.random() * 8).toFixed(0) + '¬∞C';
                
                // Animate machine status indicators
                if (animationEnabled) {
                    Object.values(machines).forEach(machine => {
                        const indicator = machine.children.find(child => 
                            child.geometry instanceof THREE.SphereGeometry
                        );
                        if (indicator) {
                            indicator.rotation.y += 0.1;
                            
                            // Pulse effect for critical machines
                            const health = machine.userData.data.health;
                            if (health < 50) {
                                const scale = 1 + Math.sin(Date.now() * 0.01) * 0.3;
                                indicator.scale.setScalar(scale);
                            }
                        }
                    });
                }
                
                // Update ML status
                document.getElementById('ml-status').textContent = 'Online (' + Math.floor(Math.random() * 1000) + 'ms)';
                
            }, 2000);
        }
        
        // Helper functions
        function getStatusColor(status) {
            switch(status) {
                case 'operational': return 0x00ff88;
                case 'maintenance': return 0xff6b6b;
                case 'warning': return 0xffd93d;
                default: return 0x666666;
            }
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (animationEnabled) {
                // Rotate some elements
                scene.children.forEach(child => {
                    if (child.userData.type === 'machine' && child.userData.data.status === 'operational') {
                        // Subtle rotation for operational machines
                        child.rotation.y += 0.002;
                    }
                });
            }
            
            renderer.render(scene, camera);
        }
        
        // Window resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Initialize on load
        window.addEventListener('load', () => {
            init3D();
        });
        
        // Close machine details when clicking outside
        document.addEventListener('click', (event) => {
            const detailsPanel = document.getElementById('machine-details');
            if (!detailsPanel.contains(event.target) && !renderer.domElement.contains(event.target)) {
                detailsPanel.style.display = 'none';
                if (selectedMachine) {
                    selectedMachine.children[0].material.emissive.setHex(0x000000);
                    selectedMachine = null;
                }
            }
        });
    </script>
</body>
</html>